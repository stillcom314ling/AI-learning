name: Unity License Activation

on:
  workflow_dispatch:
  issue_comment:
    types: [created]

jobs:
  request-activation-file:
    name: Request Activation File
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_dispatch' ||
      (github.event.issue.pull_request && contains(github.event.comment.body, '/activate'))
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Request manual activation file
        id: getManualLicenseFile
        uses: game-ci/unity-request-activation-file@v2
        with:
          unityVersion: 2022.3.20f1

      - name: Upload activation file
        uses: actions/upload-artifact@v4
        with:
          name: Unity-Activation-File
          path: ${{ steps.getManualLicenseFile.outputs.filePath }}
          retention-days: 1

      - name: Instructions
        run: |
          echo "## Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. **Download** the \`Unity-Activation-File\` artifact from this workflow run" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "2. **Go to** [Unity Manual Activation](https://license.unity3d.com/manual)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "3. **Upload** the \`.alf\` file you downloaded" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "4. **Select** your license type (Personal, Plus, or Pro)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "5. **Download** the \`.ulf\` license file Unity provides" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "6. **Open** the \`.ulf\` file in a text editor and copy ALL contents" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "7. **Create** a repository secret named \`UNITY_LICENSE\` with the copied contents:" >> $GITHUB_STEP_SUMMARY
          echo "   - Go to: Settings → Secrets and variables → Actions → New repository secret" >> $GITHUB_STEP_SUMMARY
          echo "   - Name: \`UNITY_LICENSE\`" >> $GITHUB_STEP_SUMMARY
          echo "   - Value: (paste the entire .ulf file contents)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "8. **Also add** these secrets (your Unity account credentials):" >> $GITHUB_STEP_SUMMARY
          echo "   - \`UNITY_EMAIL\` - Your Unity account email" >> $GITHUB_STEP_SUMMARY
          echo "   - \`UNITY_PASSWORD\` - Your Unity account password" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "9. **Run** the Unity Build workflow again!" >> $GITHUB_STEP_SUMMARY
